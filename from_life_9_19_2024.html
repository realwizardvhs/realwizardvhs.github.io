<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.min.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css">
    <meta charset="utf-8">
    <title>Sketch</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div id="navbar"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center">
                <div id="sketch-holder"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center">
                <div id="sketch-controls">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center">
                <h1 id="art_title">From Life</h1>
                <p id="art_date">9/19/2024</p>
                <p id="art-description">
                    Coming And Going <br>
                    Waitng And Watching <br>
                    Never Different In The Same Way <br>
                    Always The Same In A Different Way <br>
                </p>
            </div>
        </div>
    </div>


    <script src="navbar.js"></script>
    <script>

        class Polygon{
            constructor(){
                this.points = []
                this.fill_color = color(0);
            }
        }

        let canvas
        let font;

        let active_polygon;

        let polygons = []
        let active_color;

        let vanishing_timers = []

        function setup() {
            canvas =createCanvas(800, 600)
            canvas.parent("sketch-holder")
            active_polygon = 0
            polygons.push(new Polygon());
            load_polygon_file()
        }
        function load_polygon_file() {
            loadJSON('data/polygon.json', function (data) {

                if (data) {
                    let i = 0
                    for (entry of data) {
                        let fill_color = color(entry.fill_color.levels);
                        let points = [];
                        for (let point of entry.points) {
                            let vector = createVector(point.x, point.y);
                            points.push(vector);

                        }
                        let polygon = new Polygon();
                        polygon.fill_color = fill_color;
                        if (entry.animated) {
                            polygon.animated = entry.animated;
                            vanishing_timers.push([i, random(1000, 5000)]);
                        } else {
                            polygon.animated = false;
                            vanishing_timers.push([i, null]);
                        }
                        // console.log(fill_color)
                        polygon.points = points;
                        polygons.push(polygon);
                        i++
                    }
                }
                active_polygon = polygons.length - 1;
            });
        }

        function draw() {
            background('lightblue')
            for (let v of vanishing_timers) {
                if (v[1] == null) {
                    continue;
                }
                v[1] -= deltaTime;
                if (v[1] <= 0) {
                    v[1] = random(1000, 5000);
                }
            }


            for (let i = 0; i < polygons.length; i++) {
                let polygon = polygons[i];
                fill(polygon.fill_color);
                noStroke()

                if (polygon.animated) {
                    let v = vanishing_timers[i];
                    if (!v) {
                        continue
                    }
                    if (v[1] == null) {
                        continue;
                    }
                    let alpha = map(v[1], 0, 5000, 0, 255);
                    fill(red(polygon.fill_color), green(polygon.fill_color), blue(polygon.fill_color), alpha);
                }
                beginShape();
                for (let j = 0; j < polygon.points.length; j++) {
                    let p = polygon.points[j];
                    let draw_p_x = p.x;
                    let draw_p_y = p.y;
                    if (polygon.animated) {
                        draw_p_x += (random(-0.25, 0.25) * deltaTime)
                        draw_p_y += (random(-0.25, 0.25) * deltaTime)
                    }
                    vertex(draw_p_x, draw_p_y);
                }
                endShape(CLOSE);
            }
            tint(255, 5);
            noTint()
            if (polygons[active_polygon].animated) {
                fill(255, 0, 0)
            }
            textSize(22)
        }
    </script>
</body>

</html>